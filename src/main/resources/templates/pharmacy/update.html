<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body>

<!-- üîπ –ù–∞–≤–±–∞—Ä -->
<div th:replace="fragments/header :: body"></div>


<!-- üîπ –ö–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container my-5">
    <h3 class="fw-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</h3>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <form th:action="@{/pharmacies/{id}(id=${pharmacy.id})}"
          th:object="${pharmacy}" method="post" enctype="multipart/form-data" class="w-75">
        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
        <div class="mb-3">
            <label class="form-label fw-semibold">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="text-danger">*</span></label>
            <input type="text" class="form-control" th:field="*{medication.name}" required>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="mb-3">
            <label class="form-label fw-semibold">–û–ø–∏—Å–∞–Ω–∏–µ <span class="text-danger">*</span></label>
            <textarea class="form-control" rows="3" th:field="*{medicationDescription}" required></textarea>
        </div>

        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ -->
        <div class="mb-3">
            <label class="form-label fw-semibold">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, —à—Ç <span class="text-danger">*</span></label>
            <input type="number" class="form-control" th:field="*{quantity}" required>
        </div>

        <!-- –î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏ -->
        <div class="mb-3">
            <label class="form-label fw-semibold">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</label>
            <input type="date" class="form-control" th:field="*{purchaseDate}">
        </div>


        <!-- –°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ -->
        <div class="mb-3">
            <label class="form-label fw-semibold">–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –¥–æ <span class="text-danger">*</span></label>
            <input type="date" class="form-control" th:field="*{expirationDate}" required>
        </div>

        <div class="mb-4">
            <label class="form-label fw-semibold">–§–æ—Ç–æ</label>

            <!-- üîπ –§–æ—Ç–æ (—Ç–µ–∫—É—â–µ–µ –∏–ª–∏ –Ω–æ–≤–æ–µ) -->
            <div class="mb-2">
                <img id="currentImage"
                     th:if="*{image != null}"
                     th:src="*{image}"
                     alt="–§–æ—Ç–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞"
                     class="img-thumbnail"
                     style="max-width: 200px; max-height: 200px;">
            </div>

            <!-- üîπ –í—ã–±–æ—Ä –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ç–æ -->
            <input class="form-control" type="file" th:field="*{image}" id="imageInput">
        </div>

        <!-- üîπ JS –¥–ª—è –∑–∞–º–µ–Ω—ã —Ñ–æ—Ç–æ -->
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const input = document.getElementById("imageInput");
                const currentImage = document.getElementById("currentImage");

                input.addEventListener("change", () => {
                    const file = input.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = e => {
                            currentImage.src = e.target.result; // –∑–∞–º–µ–Ω—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
                            currentImage.style.display = "block"; // –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ä–∞–Ω—å—à–µ —Ñ–æ—Ç–æ –Ω–µ –±—ã–ª–æ
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        </script>


        <!-- üîπ –°–ø–∏—Å–æ–∫ –±–æ–ª–µ–∑–Ω–µ–π -->
        <div class="mb-4">
            <label class="form-label fw-semibold">–ë–æ–ª–µ–∑–Ω–∏</label>
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                <tr>
                    <th style="width: 50px;">–í—ã–±—Ä–∞—Ç—å</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="disease : ${diseases}">
                    <td class="text-center">
                        <input type="checkbox" th:value="${disease.id}" th:field="*{medication.diseases}">
                    </td>
                    <td th:text="${disease.name}"></td>
                    <td th:text="${disease.description}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <button type="submit" class="btn btn-success px-4 shadow mt-3">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <a th:href="@{/pharmacies}" class="btn btn-secondary px-4 shadow mt-3 ms-2">–û—Ç–º–µ–Ω–∞</a>
    </form>
</div>


<!-- üîπ –§—É—Ç–µ—Ä -->
<div th:replace="fragments/footer :: footer"></div>

</body>
</html>